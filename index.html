<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="8;url=about:blank">
<title>Order Confirmed</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f7f8fa;min-height:100vh;display:flex;align-items:center;justify-content:center;color:#1a1a1a;padding:20px;line-height:1.6}
.container{max-width:580px;width:100%;background:white;border-radius:16px;box-shadow:0 1px 3px rgba(0,0,0,0.05),0 10px 40px rgba(0,0,0,0.08);overflow:hidden;animation:slideUp 0.4s cubic-bezier(0.16,1,0.3,1)}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.header{background:linear-gradient(135deg,#0066ff 0%,#0052cc 100%);padding:48px 40px;text-align:center;position:relative;overflow:hidden}
.success-icon{width:80px;height:80px;margin:0 auto 24px;position:relative;z-index:1}
.checkmark-circle{animation:scaleIn 0.5s cubic-bezier(0.16,1,0.3,1) 0.1s both}
.checkmark-path{stroke-dasharray:60;stroke-dashoffset:60;animation:drawCheck 0.4s ease-out 0.3s forwards}
@keyframes scaleIn{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes drawCheck{to{stroke-dashoffset:0}}
h1{font-size:28px;font-weight:700;color:white;margin-bottom:8px;letter-spacing:-0.5px;position:relative;z-index:1}
.subtitle{font-size:16px;color:rgba(255,255,255,0.9);font-weight:500;position:relative;z-index:1}
.content{padding:40px}
.order-number{background:#f7f8fa;border-radius:12px;padding:20px;margin-bottom:32px;display:flex;justify-content:space-between;align-items:center}
.order-label{font-size:14px;color:#6b7280;font-weight:500}
.order-value{font-size:15px;color:#1a1a1a;font-weight:600;font-family:'Courier New',monospace}
.info-section{margin-bottom:32px}
.info-title{font-size:18px;font-weight:600;color:#1a1a1a;margin-bottom:16px}
.info-text{font-size:15px;color:#6b7280;line-height:1.6;margin-bottom:12px}
.features{margin-top:24px}
.feature{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid #f3f4f6}
.feature:last-child{border-bottom:none}
.feature-icon{width:20px;height:20px;flex-shrink:0;margin-top:2px}
.feature-text{font-size:15px;color:#1a1a1a;font-weight:500}
.feature-description{font-size:14px;color:#6b7280;margin-top:2px}
.status-banner{background:linear-gradient(135deg,#ecfdf5 0%,#d1fae5 100%);border:1px solid #a7f3d0;border-radius:12px;padding:16px 20px;margin-bottom:32px;display:flex;align-items:center;gap:12px}
.status-text{font-size:14px;color:#065f46;font-weight:500}
.button{width:100%;padding:16px;background:#0066ff;color:white;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:'Inter',sans-serif}
.button:hover{background:#0052cc;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,102,255,0.3)}
.footer-note{text-align:center;margin-top:24px;font-size:13px;color:#9ca3af}
.divider{height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:32px 0}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="success-icon">
<svg viewBox="0 0 80 80" fill="none">
<circle class="checkmark-circle" cx="40" cy="40" r="36" fill="white"/>
<path class="checkmark-path" d="M23 40L34 51L57 28" stroke="#0066ff" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</div>
<h1>Order Confirmed</h1>
<p class="subtitle">Thank you for your purchase</p>
</div>
<div class="content">
<div class="order-number">
<span class="order-label">Order Number</span>
<span class="order-value">#DS-<span id="orderNumber"></span></span>
</div>
<div class="status-banner">
<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
<circle cx="10" cy="10" r="9" fill="#10b981"/>
<path d="M6 10l3 3 5-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
<span class="status-text">Your subscription is being activated...</span>
</div>
<div class="info-section">
<h2 class="info-title">What's Next?</h2>
<p class="info-text">Your Design System Sync Pro subscription is now active. Return to Figma to start using your unlimited features.</p>
</div>
<div class="features">
<div class="feature">
<svg class="feature-icon" viewBox="0 0 20 20" fill="none">
<circle cx="10" cy="10" r="8" stroke="#0066ff" stroke-width="2" fill="none"/>
<path d="M9 6h2v5H9V6zm0 6h2v2H9v-2z" fill="#0066ff"/>
</svg>
<div>
<div class="feature-text">Unlimited Scans</div>
<div class="feature-description">Scan variables and components without limits</div>
</div>
</div>
<div class="feature">
<svg class="feature-icon" viewBox="0 0 20 20" fill="none">
<path d="M4 4h12v2H4V4zm0 5h12v2H4V9zm0 5h12v2H4v-2z" fill="#0066ff"/>
</svg>
<div>
<div class="feature-text">Export Anywhere</div>
<div class="feature-description">Export to GitHub, Bitbucket, and more</div>
</div>
</div>
<div class="feature">
<svg class="feature-icon" viewBox="0 0 20 20" fill="none">
<path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-3H9V6h2v4z" fill="#0066ff"/>
</svg>
<div>
<div class="feature-text">Priority Support</div>
<div class="feature-description">Get help when you need it</div>
</div>
</div>
</div>
<div class="divider"></div>
<button class="button" onclick="closeWindow()">Return to Figma</button>
<p class="footer-note">You can close this tab and return to Figma</p>
</div>
</div>
<script>
// Get session_id from URL parameters
const urlParams = new URLSearchParams(window.location.search);
const sessionId = urlParams.get('session_id');

// Fetch invoice ID from Stripe session
async function fetchInvoiceId() {
  if (!sessionId) {
    // Fallback to using session ID format
    document.getElementById('orderNumber').textContent = Math.random().toString(36).substring(2,9).toUpperCase();
    return;
  }

  try {
    // Call our edge function to get invoice details
    const response = await fetch('https://yhjtvcfjtawarrvoaztg.supabase.co/functions/v1/get-invoice-id', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ sessionId })
    });

    const data = await response.json();

    if (data.invoiceId) {
      // Display real invoice number (e.g., in_1AbC2dEf becomes 1ABC2DEF)
      const invoiceNum = data.invoiceId.replace('in_', '').substring(0, 8).toUpperCase();
      document.getElementById('orderNumber').textContent = invoiceNum;
    } else {
      // Use session ID as fallback
      document.getElementById('orderNumber').textContent = sessionId.substring(sessionId.length - 8).toUpperCase();
    }
  } catch (error) {
    console.error('Error fetching invoice:', error);
    // Use session ID as fallback
    document.getElementById('orderNumber').textContent = sessionId.substring(sessionId.length - 8).toUpperCase();
  }
}

// Load invoice ID
fetchInvoiceId();

// Update status after 2 seconds
setTimeout(() => {
  document.querySelector('.status-text').textContent = 'Subscription activated successfully';
}, 2000);

// Countdown timer
let countdown = 8;
const footerNote = document.querySelector('.footer-note');
const countdownInterval = setInterval(() => {
  countdown--;
  if (countdown > 0) {
    footerNote.textContent = `Closing in ${countdown} seconds... (or click the button)`;
  } else {
    clearInterval(countdownInterval);
    footerNote.textContent = 'You can close this tab now';
  }
}, 1000);

// Function to close window
function closeWindow() {
  window.close();
  // If window doesn't close, redirect to blank
  setTimeout(() => {
    window.location.href = 'about:blank';
  }, 100);
}
</script>
</body>
</html>
